using MeUi.Api.Endpoints;
using MeUi.Application.Features.MalwareFamilies.Commands.CreateMalwareFamily;
using MeUi.Application.Interfaces;

namespace MeUi.Api.Endpoints.MalwareFamilies;

public class CreateMalwareFamilyEndpoint : BaseAuthorizedEndpoint<CreateMalwareFamilyCommand, Guid, CreateMalwareFamilyEndpoint>, IPermissionProvider
{
    public static string Permission => "CREATE:MALWARE_FAMILY";

    public override void ConfigureEndpoint()
    {
        Post("api/v1/malware-families");
        Description(x => x.WithTags("Malware Family Management")
            .WithSummary("Create a new malware family")
            .WithDescription("Creates a new malware family entry in the global taxonomy. Requires CREATE:MALWARE_FAMILY permission."));
    }
    public override async Task HandleAuthorizedAsync(CreateMalwareFamilyCommand req, Guid userId, CancellationToken ct)
    {
        Guid malwareFamilyId = await Mediator.Send(req, ct);
        await SendSuccessAsync(malwareFamilyId, "Malware family created successfully", ct);
    }
}
